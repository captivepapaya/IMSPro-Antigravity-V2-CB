# BOM 智能搜索功能更新

## 🎉 新功能：智能产品代码搜索

现在BOM字段支持智能搜索和自动完成功能！

### ✨ 功能特点

#### 1. **实时搜索**
- 输入时自动显示匹配的产品代码
- 最多显示50个匹配结果
- 搜索结果实时更新

#### 2. **大小写不敏感**
- 输入 "h2630" 或 "H2630" 都能找到 "H-2630"
- 自动转换为大写

#### 3. **标点符号不敏感**
- 输入 "h2630" 可以找到 "H-2630"
- 输入 "30123" 可以找到 "30.123.12"
- 忽略所有标点符号（点、横线等）

#### 4. **智能排除**
- 自动排除当前产品本身
- 避免将产品设置为自己的原材料

#### 5. **用户友好界面**
- 黄色主题边框，与BOM部分一致
- 显示匹配数量："X matches found for 'search term'"
- 下拉菜单可滚动，最大高度限制
- 点击外部自动关闭

### 📖 使用方法

#### 在 Add New Product 页面

1. 选择供应商为 **LL**
2. 滚动到 **Bill of Materials (BOM)** 部分
3. 点击 **Raw Material Code (BOM)** 输入框
4. 开始输入产品代码的任意部分：
   - 输入 "h26" → 显示所有包含 "h26" 的产品
   - 输入 "30123" → 显示所有包含 "30123" 的产品
5. 从下拉列表中选择正确的产品代码
6. 设置数量（默认为1）
7. 点击 **Create Product** 保存

#### 在 Product List 编辑页面

1. 找到供应商为LL的产品
2. 点击左侧的笔图标进入编辑
3. 滚动到 **Bill of Materials (BOM)** 部分
4. 如果已有BOM数据，会自动加载显示
5. 点击 **Raw Material Code (BOM)** 输入框
6. 开始输入搜索：
   - 搜索会自动排除当前产品代码
   - 输入部分代码即可快速定位
7. 从下拉列表选择或直接输入
8. 点击 **Save Changes** 保存

### 🎯 搜索示例

| 输入 | 能找到的示例 |
|------|-------------|
| `h26` | H-2630, H-2602Gr, H-2602Gy, H-2029, H-2021D |
| `30` | 30.419.12, 30.338.12, 30.468.12, 30.698.12 |
| `fi` | FI7868VG, FI7868FS, FI8290GR, FI7985GR |
| `grn` | S8746Grn, S8967Grn, S8756Grn, S8818Grn |
| `6` | 5691, 6521, 5836, 5837, 6756, 6662 |

### 🔍 搜索算法

搜索使用**标准化匹配**算法：

```
输入: "h2630"
标准化: "h2630" (移除标点，转小写)

数据库中的 "H-2630"
标准化: "h2630" (移除标点，转小写)

匹配: ✅ 成功
```

### 💡 提示和技巧

1. **快速定位**
   - 输入产品代码的核心数字部分
   - 例如：找 "30.536.12"，只需输入 "536"

2. **模糊搜索**
   - 不确定完整代码？输入部分即可
   - 系统会显示所有匹配项

3. **键盘导航**
   - 点击输入框自动清空并显示下拉列表
   - 点击外部自动关闭下拉列表

4. **性能优化**
   - 结果限制在50个，确保快速响应
   - 未输入时显示前50个产品代码

### 🎨 UI 元素说明

#### 输入框状态
- **未选择**: 白色文字
- **已选择**: 黄色文字（高亮显示）
- **聚焦时**: 黄色边框

#### 下拉菜单
- **顶部**: 显示匹配数量和搜索词
- **列表项**: 等宽字体（font-mono）便于阅读
- **悬停**: 黄色背景高亮
- **滚动**: 自定义滚动条样式

#### 提示信息
- 输入框下方：说明搜索特性
- 无结果时：显示 "No matching codes found"

### 🔧 技术细节

#### 数据源
- 从Core数据库（Supabase）加载所有产品代码
- 使用全局缓存 `window.__CORE_DATA_CACHE__`
- 应用启动时自动加载

#### 搜索性能
- 客户端搜索，无需服务器请求
- 使用 `useMemo` 优化性能
- 标准化算法复杂度: O(n)

#### 排除逻辑
```typescript
// 自动排除当前产品
if (currentProductCode && code === currentProductCode) return false;
```

### 📝 更新日志

**版本 1.1.0** (2025-12-24)
- ✅ 添加智能搜索功能
- ✅ 大小写不敏感匹配
- ✅ 标点符号不敏感匹配
- ✅ 自动排除当前产品
- ✅ 实时搜索结果
- ✅ 用户友好的下拉界面

### 🐛 已知限制

1. **结果限制**: 最多显示50个匹配结果
   - 解决方案：输入更具体的搜索词

2. **缓存依赖**: 需要Core数据已加载
   - 解决方案：等待应用完全加载后使用

### 🎓 最佳实践

1. **精确搜索**: 输入产品代码的唯一部分
2. **验证选择**: 选择后检查显示的代码是否正确
3. **保存前确认**: 确保BOM和QtyBom都已填写

### 🆘 故障排除

**问题**: 下拉列表为空
- **原因**: Core数据未加载
- **解决**: 等待应用完全初始化，刷新页面

**问题**: 找不到已知存在的产品
- **原因**: 搜索词可能不匹配
- **解决**: 尝试输入产品代码的不同部分

**问题**: 选择后代码不正确
- **原因**: 可能选错了
- **解决**: 重新打开下拉列表，仔细选择

---

## 🎉 享受更高效的BOM管理体验！

智能搜索功能让您能够快速、准确地找到所需的原材料代码，大大提高了工作效率！
